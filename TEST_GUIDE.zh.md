# Claude-Gemini-Router æµ‹è¯•æŒ‡å—

æœ¬æŒ‡å—è¯´æ˜äº†å¦‚ä½•è¿è¡Œ Claude-Gemini-Router é›†æˆçš„å…¨é¢æµ‹è¯•å¥—ä»¶ã€‚

## æµ‹è¯•ç»“æ„

æµ‹è¯•å¥—ä»¶åˆ†ä¸ºä¸‰ä¸ªä¸»è¦ç±»åˆ«ï¼š

### 1. å•å…ƒæµ‹è¯•ï¼ˆæ ¼å¼åŒ–å™¨ï¼‰

- **ä½ç½®**ï¼š`tests/formatters/`
- **ç›®çš„**ï¼šä½¿ç”¨ç¤ºä¾‹è½½è·æµ‹è¯•è¯·æ±‚/å“åº”æ ¼å¼åŒ–å™¨
- **è¿è¡Œ**ï¼š`npm test`

#### æµ‹è¯•è¦†ç›–

- âœ… **formatRequest.test.ts**ï¼šæµ‹è¯•ä» Anthropic åˆ° OpenAI çš„è¯·æ±‚æ ¼å¼åŒ–
- âœ… **formatRequestGemini.test.ts**ï¼šæµ‹è¯•ä» Anthropic åˆ° Gemini çš„è¯·æ±‚æ ¼å¼åŒ–  
- âœ… **formatResponse.test.ts**ï¼šæµ‹è¯•ä» OpenAI åˆ° Anthropic çš„å“åº”æ ¼å¼åŒ–
- âœ… **formatResponseGemini.test.ts**ï¼šæµ‹è¯•ä» Gemini åˆ° Anthropic çš„å“åº”æ ¼å¼åŒ–

### 2. é›†æˆæµ‹è¯•

- **ä½ç½®**ï¼š`tests/integration/`
- **ç›®çš„**ï¼šæµ‹è¯•ä½¿ç”¨ Gemini API çš„å®é™… Workerï¼ŒåŒ…æ‹¬æµå¼å’Œéæµå¼è¯·æ±‚
- **è¿è¡Œ**ï¼š`npm run test:integration`

#### å…ˆå†³æ¡ä»¶

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`wrangler dev`
2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`export GEMINI_API_KEY=your_api_key`

#### æµ‹è¯•è¦†ç›–

- âœ… **éæµå¼è¯·æ±‚**ï¼šç®€å•æ¶ˆæ¯ã€ç³»ç»Ÿæ¶ˆæ¯ã€å·¥å…·è°ƒç”¨
- âœ… **æµå¼è¯·æ±‚**ï¼šæµå¼æ–‡æœ¬ã€æµå¼å·¥å…·è°ƒç”¨
- âœ… **é”™è¯¯å¤„ç†**ï¼šæ— æ•ˆæ¨¡å‹ã€æ ¼å¼é”™è¯¯è¯·æ±‚
- âœ… **Worker ç«¯ç‚¹**ï¼šç´¢å¼•é¡µã€404 å¤„ç†

### 3. å·¥å…·è°ƒç”¨éªŒè¯æµ‹è¯•

- **ç›®çš„**ï¼šéªŒè¯å·¥å…·è°ƒç”¨åœºæ™¯å¹¶ç¡®ä¿æ­£ç¡®çš„æ ¼å¼åŒ–
- **è¦†ç›–**ï¼šå®Œæ•´å·¥å…·è°ƒç”¨åºåˆ—ã€ä¸å®Œæ•´å·¥å…·è°ƒç”¨ã€å¤šé‡å·¥å…·è°ƒç”¨

## è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
npm run test:all
```

### ä»…è¿è¡Œå•å…ƒæµ‹è¯•

```bash
npm test
```

### ä»…è¿è¡Œé›†æˆæµ‹è¯•

```bash
# å…ˆå†³æ¡ä»¶ï¼šå¯åŠ¨ wrangler dev å¹¶è®¾ç½® GEMINI_API_KEY
wrangler dev &
export GEMINI_API_KEY=your_api_key
npm run test:integration
```

### ä»¥ç›‘è§†æ¨¡å¼è¿è¡Œæµ‹è¯•

```bash
npm run test:watch
```

## æµ‹è¯•ç»“æœæ‘˜è¦

### å•å…ƒæµ‹è¯• âœ…

- **æ€»æµ‹è¯•æ•°**ï¼š54 ä¸ªé€šè¿‡
- **æµ‹è¯•å¥—ä»¶**ï¼š4 ä¸ªé€šè¿‡
- **è¦†ç›–èŒƒå›´**ï¼šä½¿ç”¨å…¨é¢ç¤ºä¾‹è½½è·çš„è¯·æ±‚/å“åº”æ ¼å¼åŒ–å™¨

### é›†æˆæµ‹è¯• ğŸ”„

- **å…ˆå†³æ¡ä»¶**ï¼šéœ€è¦è¿è¡Œ `wrangler dev` å’Œæœ‰æ•ˆçš„ `GEMINI_API_KEY`
- **æµ‹è¯•åœºæ™¯**ï¼š
  - éæµå¼è¯·æ±‚
  - æµå¼è¯·æ±‚
  - å·¥å…·è°ƒç”¨éªŒè¯
  - é”™è¯¯å¤„ç†
  - Worker ç«¯ç‚¹éªŒè¯

## æµ‹è¯•çš„ç¤ºä¾‹è½½è·

### ç®€å•æ¶ˆæ¯

```json
{
  "model": "claude-3-haiku-20240307",
  "messages": [
    {
      "role": "user", 
      "content": "Hello, how are you today?"
    }
  ],
  "temperature": 0.7
}
```

### ç³»ç»Ÿæ¶ˆæ¯

```json
{
  "model": "claude-3-sonnet-20240229",
  "messages": [
    {
      "role": "user",
      "content": "What is the weather like?"
    }
  ],
  "system": "You are a helpful weather assistant.",
  "temperature": 0.3
}
```

### å·¥å…·è°ƒç”¨

```json
{
  "model": "claude-3-sonnet-20240229",
  "messages": [
    {
      "role": "user",
      "content": "What's the weather like in New York?"
    }
  ],
  "tools": [
    {
      "name": "get_weather",
      "description": "Get the current weather in a given location",
      "input_schema": {
        "type": "object",
        "properties": {
          "location": {
            "type": "string",
            "description": "The city and state, e.g. San Francisco, CA"
          }
        },
        "required": ["location"]
      }
    }
  ]
}
```

### æµå¼è¯·æ±‚

```json
{
  "model": "claude-3-haiku-20240307",
  "messages": [
    {
      "role": "user",
      "content": "Tell me a short story"
    }
  ],
  "stream": true
}
```

## æµ‹è¯•éªŒè¯

### å›å½’æµ‹è¯• âœ…

- **æ¨¡å‹æ˜ å°„**ï¼šAnthropic å’Œ Gemini æ¨¡å‹ä¹‹é—´çš„æ­£ç¡®æ˜ å°„
- **è¯·æ±‚æ ¼å¼åŒ–**ï¼šå°† Anthropic è¯·æ±‚æ­£ç¡®è½¬æ¢ä¸º Gemini æ ¼å¼
- **å“åº”æ ¼å¼åŒ–**ï¼šå°† Gemini å“åº”æ­£ç¡®è½¬æ¢ä¸º Anthropic æ ¼å¼
- **å·¥å…·è°ƒç”¨éªŒè¯**ï¼šæ­£ç¡®å¤„ç† tool_calls å’Œ tool_results
- **æµå¼ä¼ è¾“**ï¼šä¸ºæµå¼å“åº”ç”Ÿæˆæ­£ç¡®çš„ SSE äº‹ä»¶

### å·¥å…·è°ƒç”¨åœºæ™¯ âœ…

- **å®Œæ•´å·¥å…·è°ƒç”¨**ï¼šä¸åŒ¹é…å·¥å…·ç»“æœçš„å·¥å…·è°ƒç”¨
- **ä¸å®Œæ•´å·¥å…·è°ƒç”¨**ï¼šæ²¡æœ‰åŒ¹é…ç»“æœçš„å·¥å…·è°ƒç”¨ï¼ˆå·²è¿‡æ»¤ï¼‰
- **å¤šé‡å·¥å…·è°ƒç”¨**ï¼šå¤šä¸ªåŒæ—¶å·¥å…·è°ƒç”¨
- **æ··åˆå†…å®¹**ï¼šåŒä¸€å“åº”ä¸­çš„æ–‡æœ¬å’Œå·¥å…·è°ƒç”¨

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é›†æˆæµ‹è¯•å¤±è´¥**ï¼šç¡®ä¿ `wrangler dev` æ­£åœ¨è¿è¡Œä¸” `GEMINI_API_KEY` å·²è®¾ç½®
2. **æµ‹è¯•è¶…æ—¶**ï¼šä¸ºæ…¢é€Ÿ API å“åº”å¢åŠ è¶…æ—¶æ—¶é—´
3. **ç±»å‹é”™è¯¯**ï¼šç¡®ä¿ä½¿ç”¨ `npm install` å®‰è£…äº†æ‰€æœ‰ä¾èµ–é¡¹

### è°ƒè¯•æ¨¡å¼

```bash
# ä»¥è¯¦ç»†è¾“å‡ºè¿è¡Œæµ‹è¯•
npm test -- --verbose

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm test -- formatRequest.test.ts
```

## ä¸‹ä¸€æ­¥

æˆåŠŸè¿è¡Œæµ‹è¯•åï¼š

1. âœ… å•å…ƒæµ‹è¯•éªŒè¯æ ¼å¼åŒ–å™¨é€»è¾‘
2. âœ… é›†æˆæµ‹è¯•éªŒè¯ç«¯åˆ°ç«¯åŠŸèƒ½
3. âœ… å·¥å…·è°ƒç”¨åœºæ™¯å¾—åˆ°æ­£ç¡®å¤„ç†
4. âœ… æµå¼å’Œéæµå¼éƒ½æ­£å¸¸å·¥ä½œ

æµ‹è¯•å¥—ä»¶ä¸º Claude-Gemini-Router é›†æˆæä¾›äº†å…¨é¢çš„è¦†ç›–ï¼Œç¡®ä¿ä¸ Google Gemini API åç«¯çš„å¯é æ“ä½œã€‚
